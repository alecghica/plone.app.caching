Plone caching to-do
===================

Zope 2
------

 [ ] Send ObjectModifiedEvent for OFS File/Image

plone.app.caching
-----------------
 
 [ ] Add IPurgePaths for ...
        - /view
        - default view(s)
        - object fields
        - image scales
        - parent
        - parent default view if set as default page
 
 [ ] Add manual purge to UI
 
 [ ] Document purging
 
 [ ] Update KGS
 
 [ ] Build default response mutators
        - CacheFu has the following:
            - no-cache
            - cache-with-etag
            - cache-with-last-modified
            - cache-in-proxy (configurable length)
            - cache-in-browser (configurable length)
            - cache-in-memory (like an interceptor)
        - We probably want more semantic types:
            - no-cache
            - content-item
                - assume some personalisation
            - content-folder
                - assume dynamic rendering
            - content-feed
                - e.g. RSS feed template
            - static-resources
                - e.g. OFS File/Image, FS File/FSImage, Z3-style resources
                - can implement differently for each type with overloaded
                  adapter
                - may need a special check for the isCacheable() flag in
                  ResourceRegistries and/or the ZCacheable flags in OFS.Cache.
        - We want a library of helper functions to perform standard checks
          and header operations, in ``plone.app.caching.operations.utils``. 
 
 [ ] Build default cache interceptors
        - check-not-modified
                - check for If-None-Match and/or If-Modified-Since
                - set 304 response and return empty
                - use ILastModified adapter
        - ram-cached
                - check if stale
                - look up in cache manager and return

 [ ] Functional tests

Cache lookup investigations
===========================

The following things have been spotted as published objects, which we may want
to cache:

Page templates
--------------

**Types:**

* ``Products.CMFCore.FSPageTemplate.FSPageTemplate``
    => inherits: ``Products.PageTemplates.PageTemplate.PageTemplate``
* ``Products.PageTemplates.ZopePageTemplate.ZopePageTemplate``
    => inherits: ``Products.PageTemplates.PageTemplate.PageTemplate``

* ``Products.CMFFormController.FSControllerPageTemplate.FSControllerPageTemplate``
    => inherits: ``Products.CMFCore.FSPageTemplate.FSPageTemplate``
* ``Products.CMFFormController.ControllerPageTemplate.ControllerPageTemplate``
    => inherits: ``Products.PageTemplates.ZopePageTemplate.ZopePageTemplate``

**Strategy:**
    
* Register lookup for ``Products.PageTemplates.PageTemplate.PageTemplate``
* Lookup rule by name (``__name__``)
* Fall back to lookup rule by context type (``__parent__.portal_type``) if the
  view name is a default view for the corresponding content type

Zope 2 style resources
----------------------

**Types:**

* ``Products.CMFCore.FSFile.FSFile`` (via ``index_html``)
    => through skin layer
* ``Products.CMFCore.FSImage.FSImage`` (via ``index_html``)
    => through skin layer
* ``OFS.Image.File`` (via ``index_html``)
    => can be customised resource
    => or ResourceRegistries wrapper

* ``OFS.Image.Image`` (via ``index_html``)
    => inherits: ``OFS.Image.File``
    => can be customised resource

**Strategy:**

* Register cache rule for 
    => ``Products.CMFCore.FSFile.FSFile``,
    => ``Products.CMFCore.FSImage.FSImage``
    => ``OFS.Image.File``
    => name: ``zope-resource``

Zope 3 style resources
----------------------

**Types:**

* ``Products.Five.metaclass.ConcatResourceN``
* ``Products.Five.metaclass.DirContainedFileResourceN``
* ``Products.Five.metaclass.FileResourceN``
    => all generated

**Real classes:**

* ``zope.app.publisher.browser.fileresource.FileResource``
    => sets own cache headers
* ``zope.app.publisher.browser.resource.Resource``
    => base class for standard Zope resources, but not KSS concat resources
* ``Products.Five.browser.resource.Resource``
    => base class for resources generated by Five

**Strategy:**

* Register cache rule for ``Products.Five.browser.resource.Resource``
    => name: ``zope-resource`` (same as for Zope 2 style resource)
* Possibly implement differently through alternative IResponseMutator adapter
  using the same name

Other
-----

For now, we will ignore these:

* DTML methods (skin layers and TTW)
* ``App.ImageFile.ImageFile`` (used in the ZMI)
* STX and reST files (from CMF)
* Python scripts (skin layers and TTW)
* Form controller scripts and validators (skin layers and TTW)
